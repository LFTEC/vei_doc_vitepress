# 接口清单
## 物料主数据同步
当发生下列情形时，万华系统会向供应商推送物料主数据信息，以确保双方系统主数据信息一致。
* 万华与供应商签署了新的 VEI 框架合同
* 框架合同内容发生了增删改
* 主产品的主要半成品信息发生变动
* 物料描述等信息发生变动
* 采购员要求供应商同步物料全量库存
* 万华系统发现供应商备货清单异常

### 接口形式
消息服务推送

消息类型(msgType)：master-data-sync

### 字段

| fieldname | 类型 | 描述 | 详细信息 |
| --- | --- | --- | --- |
| material | string | 物料编号 | 万华内部物料号，并非供应商物料号，后续其他接口交互时统一使用该物料号 |
| materialDesc | string | 物料短描述 | |
| longText | string | 物料长描述 | 包含物料特征信息的长描述，请使用该字段进行双方物料对照 |
| purLongText | string | 采购长描述 | 物料下订单时会体现在合同中的描述 |
| matType | string | 物料类型 | prod 成品 <br> semi 半成品 |
| unit | string | 物料基本单位 | 请注意这并不是最终下单时使用的单位，这里的单位是万华提需求及供应商备货时的单位 |
| deleted | bool | 删除标记 | 当物料从框架合同中排除时，会发送删除物料的消息，此标记为 true |
| fullInventory | bool | 全量库存标记 | 当该标记为 true 时，需要供应商立刻发送全量备库数据 |

#### 注意事项
当发生下面的情形时，物料的`fullInventory = true`
* 新签署 VEI 框架合同
* 合同中新增物料
* 采购员要求重新传输物料全量库存

此时，万华系统内会清空该物料的所有备库信息，请务必重新发送一次库存，否则会按无备库库存处理

当`deleted = true`时，表示双方的框架合同中排除了该物料信息。但是供应商仍可以上传对该物料的备库信息，仅在进行需求分配时会排除该物料。当框架中重新加入该物料时，系统并不会发送**全量库存标记**，而是继续使用之前备库的库存信息。

#### 示例数据

## 物料库存锁定
当万华的采购需求使用供应商的备库库存进行满足，会向该供应商发送锁定库存的通知。该通知是向供应商发送的最早的需求通知，同时也是非法律意义的订货通知。万华会因下列多种情况取消对这次库存的锁定：
* **需求取消**：需求方因各种原因不再需要该物资时，会取消该需求。如果此时 VEI 订单未生成，仅在系统锁定状态，会自动取消锁定
* **采购员取消**：采购员根据实际情况，认为不需使用 VEI 供货，或者需切换其他供应商时，会手工解除锁定

当发生库存锁定时，万华系统会自动减少系统内该供应商的备货库存；在取消锁定时，也会自动增加备货库存。<mark>因此供应商系统务必不要在接收到锁定通知后，向万华系统发送库存减少的通知，会造成备库库存的错误降低。</mark>

锁定的库存在生成订单和交货前都可以进行取消，万华系统会自动计算锁定库存信息。<mark>因此订单的发货时不要向万华发送备库减少，会造成备库库存的错误降低</mark>

### 接口形式
消息服务推送

消息类型(msgType)：material-stock-lock

### 字段
| fieldname | 类型 | 描述 | 详细信息 |
| --- | --- | --- | --- |
| material | string | 物料编号 | 万华内部物料号 |
| materialDesc | string | 物料短描述 | |
| behavior | string | 锁定行为 | lock 锁定 <br> unlock 解锁 |
| quantity | dec(13,3) | 数量 | 锁定/解锁数量，仅可为正数 |
| unit | string | 物料基本单位 | 请注意这并不是最终下单时使用的单位，这里的单位是万华提需求及供应商备货时的单位 |

#### 示例数据

## 物料库存分发
万华系统每日定时会向所有的供应商分发当前备库库存，以确保双方备库库存的一致性。如果供应商系统接收到库存后发现与本地库存有差异，可以使用库存移动接口调整万华系统的库存。

### 接口形式
消息服务推送

消息类型(msgType)：material-stock-sync

### 字段
| fieldname | 类型 | 描述 | 详细信息 |
| --- | --- | --- | --- |
| material | string | 物料编号 | 万华内部物料号 |
| type | string |  物料类型 | prod 成品 <br> semi 半成品 |
| quantity | dec(13,3) | 总库存量 |  |
| validQuantity | dec(13,3) | 有效库存 | 非锁定库存数量 |
| lockQuantity | dec(13,3) | 锁定库存 | |
| unit | string | 物料基本单位 | 请注意这并不是最终下单时使用的单位，这里的单位是万华提需求及供应商备货时的单位 |

#### 示例数据

## 库存移动接口
供应商系统针对万华的物资备库数量发生变更时，请使用该接口通知万华系统

### 接口形式
API 接口

type = API_VEI_STOCK_MOVE

### 字段
#### 请求字段
| fieldname | 类型 | 描述 | 详细信息 |
| --- | --- | --- | --- |
| vendor | string |  供应商编号 |  |
| deviceId | string |  设备编号 | 单机版专用，对接版系统请忽略 |
| olUuid | string | 唯一识别码 | 对接版专用，对接申请成功后，万华在发送的对接敏感信息中会附带该字段，在调用时返回该字段以确认身份 |
| items | array |  行项目 |  |

##### items 行项目
| fieldname | 类型 | 描述 | 详细信息 |
| --- | --- | --- | --- |
| material | string | 物料编号 | 万华内部物料号 |
| matType | string | 物料类型 | prod 成品 <br> semi 半成品 |
| moveType | string | 移动类型 | increase 库存增加 <br> decrease 库存减少 <br> full 库存全量同步 |
| quantity | dec(13,3) | 数量 | 正实数 |
| unit | string | 基本单位 | |
| text | string | 备注信息 | |

传入的 quantity 必须为正数，库存的增加与减少需要通过 moveType 来发送  
**moveType**根据传入值的不同，分三种情况：
* **increase**：库存增加，此时需传输库存的增量。万华系统会记录库存增量的时间，为备库时间久这个考核指标提供数据支持
* **decreate**：库存减少，此时需传输库存的减量。
* **full**：库存全量同步。此时万华系统会清空该物资的原有库存量，并修改为全量同步的数量，此时备库时间也修改为当前日期

#### 响应字段
| fieldname | 类型 | 描述 | 详细信息 |
| --- | --- | --- | --- |
| docId | string |  库存移动编号 | 万华系统内部编号，返回此号码表示数据更新成功 |

如果失败，请参考失败消息

##### 错误编号
| id | 描述 | 详细信息 |
| --- | --- | --- |
| ZA2001 | 无授权 |  传入的供应商号不正确，或恶意使用其他供应商编号 |
| ZA2003 | 数据不正确 | 传入的数据有问题 | 